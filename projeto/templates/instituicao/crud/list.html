{% extends "base/base.html" %}

{% load bootstrap3 %}

{% block title %} <title>Listar Todas os Instituições</title> {% endblock title %}

{% block content %}

    {% include "base/menu-projetos.html" %} <br/>

    {% if not instituicaos %}

      <h3> Nenhum Instituição Cadastrada. <a href="{% url 'new_instituicao_projeto' %}">Criar uma Instituição?</a> </h3>

    {% else %}

        {% include 'base/sort_links.html' %}

        {% for instituicao in instituicaos %}
            <ul class="list-group">
              <li class="list-group-item">
                
                <h3><a href="{{ instituicao.get_detail_url }}">{{ instituicao.nome }}</a></h3>

                <b>Descrição:</b> {{ instituicao.descricao }}
                <br/>

                <b>Sigla:</b> {{ instituicao.sigla }}

                {% if instituicao.proponentes.all %}
                  <br/>
                  <b>Projetos Associados (Como Proponente):</b>
                  {% for projeto in instituicao.proponentes.all %}
                    {% if not forloop.first %}, {% endif %}
                    <a href="{% url 'detail_projeto' projeto.id %}">{{ projeto }}</a>
                  {% endfor %}
                {% endif %}

                {% if instituicao.executora.all %}
                 <br/>
                 <b>Projetos Associados (Como Executor(a)):</b>
                 {% for projeto in instituicao.executora.all %}
                   {% if not forloop.first %}, {% endif %}
                   <a href="{% url 'detail_projeto' projeto.id %}">{{ projeto }}</a>
                 {% endfor %}
                {% endif %}

                <br/><br/>
                
                {% if request.user == instituicao.criado_por or request.user.is_superuser %}
                  <p>
                    <a href="{{ instituicao.get_update_url }}" class="btn btn-sm btn-warning">Editar</a>  
                    <a href="{{ instituicao.get_delete_url }}" class="btn btn-sm btn-danger">Apagar</a>
                  </p>
                {% endif %}

                <div class="data-atualizado">{{ instituicao.data_atualizado }}</div>
                
              </li>
            </ul>
        {% endfor %}

        {% include 'base/pagination.html' %}
        
    {% endif %} 

{% endblock content %}
